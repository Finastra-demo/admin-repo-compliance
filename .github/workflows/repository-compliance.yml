name: Repository Compliance Checker

on:
  workflow_dispatch:
    inputs:
      target_org:
        description: 'Organization to scan'
        required: false
        default: 'finastra-demo'
      dry_run:
        description: 'Dry run - no changes made'
        type: boolean
        default: true
      fix_issues:
        description: 'Auto-fix simple issues'
        type: boolean
        default: false
  
  schedule:
    # Run daily at 2 AM UTC
    - cron: '0 2 * * *'

env:
  TARGET_ORG: ${{ github.event.inputs.target_org || 'finastra-demo' }}
  DRY_RUN: ${{ github.event.inputs.dry_run || 'false' }}

jobs:
  compliance-check:
    name: Repository Compliance Check
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      
      - name: Install Dependencies
        run: |
          pip install PyGithub requests
      
      - name: Run Compliance Check
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python scripts/compliance-checker.py
      
      - name: Upload Results
        uses: actions/upload-artifact@v4
        with:
          name: compliance-report
          path: |
            compliance-report.json
            compliance-dashboard.html
